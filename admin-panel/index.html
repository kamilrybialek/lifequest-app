<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeQuest Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #F5F7FA;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: white;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .header h1 {
            font-size: 28px;
            color: #58CC02;
            margin-bottom: 8px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        /* Login */
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .login-container h2 {
            margin-bottom: 24px;
            color: #58CC02;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #E5E5E5;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group input:focus {
            outline: none;
            border-color: #58CC02;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: #58CC02;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn:hover {
            background: #46A302;
        }

        .btn-secondary {
            background: #E5E5E5;
            color: #333;
        }

        .btn-secondary:hover {
            background: #D5D5D5;
        }

        /* Dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .stat-card h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: 800;
            color: #333;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            background: white;
            padding: 12px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab.active {
            background: #58CC02;
            color: white;
        }

        .tab:hover:not(.active) {
            background: #F5F5F5;
        }

        /* Content sections */
        .content-section {
            display: none;
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .content-section.active {
            display: block;
        }

        /* Table */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #F5F5F5;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #E5E5E5;
        }

        th {
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            color: #666;
        }

        tr:hover {
            background: #F9F9F9;
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success { background: #D4EDDA; color: #155724; }
        .badge-warning { background: #FFF3CD; color: #856404; }
        .badge-info { background: #D1ECF1; color: #0C5460; }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 32px;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
        }

        .modal-content h2 {
            margin-bottom: 20px;
        }

        .hidden {
            display: none !important;
        }

        .error {
            color: #D32F2F;
            margin-top: 12px;
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }

            .header {
                padding: 16px;
                margin-bottom: 16px;
            }

            .header h1 {
                font-size: 20px;
            }

            .header p {
                font-size: 12px;
            }

            /* Stats Grid - 2 columns on mobile */
            .stats {
                grid-template-columns: 1fr 1fr;
                gap: 12px;
                margin-bottom: 16px;
            }

            .stat-card {
                padding: 16px;
            }

            .stat-card h3 {
                font-size: 12px;
            }

            .stat-card .value {
                font-size: 24px;
            }

            /* Tabs - Scrollable on mobile */
            .tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none; /* Firefox */
                -ms-overflow-style: none; /* IE/Edge */
                margin-bottom: 16px;
                gap: 8px;
                padding-bottom: 8px;
            }

            .tabs::-webkit-scrollbar {
                display: none; /* Chrome/Safari */
            }

            .tab {
                white-space: nowrap;
                font-size: 13px;
                padding: 10px 16px;
                flex-shrink: 0;
            }

            /* Recipe Filters - Stack vertically on mobile */
            .recipe-filters-grid {
                grid-template-columns: 1fr !important;
                gap: 8px !important;
                padding: 12px !important;
            }

            /* Tables - Horizontal scroll on mobile */
            table {
                display: block;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                white-space: nowrap;
                font-size: 13px;
            }

            table thead {
                display: table-header-group;
            }

            table tbody {
                display: table-row-group;
            }

            table th,
            table td {
                padding: 10px;
                font-size: 12px;
            }

            /* Buttons */
            .btn {
                font-size: 14px;
                padding: 12px;
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }

            /* Modal - Full screen on mobile */
            .modal-content {
                width: 95%;
                max-width: none;
                padding: 20px;
                max-height: 90vh;
                overflow-y: auto;
                border-radius: 12px;
            }

            .modal-content h2 {
                font-size: 20px;
                margin-bottom: 16px;
            }

            /* Form inputs - Better touch targets */
            .form-group input,
            .form-group select,
            .form-group textarea {
                font-size: 16px !important; /* Prevents zoom on iOS */
                padding: 12px !important;
                touch-action: manipulation;
            }

            /* Login container */
            .login-container {
                margin: 50px auto;
                padding: 24px;
                width: 90%;
            }

            .login-container h2 {
                font-size: 22px;
            }

            /* Content sections */
            .content-section {
                overflow-x: hidden;
            }

            .content-section h2 {
                font-size: 20px;
                margin-bottom: 16px;
            }

            .content-section h3 {
                font-size: 16px;
            }
        }

        @media (max-width: 480px) {
            /* Extra small devices */
            .header h1 {
                font-size: 18px;
            }

            .stats {
                grid-template-columns: 1fr;
            }

            .stat-card .value {
                font-size: 20px;
            }

            .tab {
                font-size: 12px;
                padding: 8px 12px;
            }

            table th,
            table td {
                padding: 8px;
                font-size: 11px;
            }
        }

        /* PWA Install prompt */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #58CC02;
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 10000;
            display: none;
            align-items: center;
            gap: 12px;
            max-width: 90%;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .install-prompt button {
            background: white;
            color: #58CC02;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            touch-action: manipulation;
        }

        .install-prompt .close-install {
            background: transparent;
            color: white;
            padding: 4px 8px;
        }
    </style>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#58CC02">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="LifeQuest Admin">
    <link rel="apple-touch-icon" href="icon-192.png">
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen">
        <div class="login-container">
            <h2>üîê Admin Login</h2>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="emailInput" placeholder="kamil.rybialek@gmail.com">
            </div>
            <button class="btn" onclick="login()">Login</button>
            <div id="loginError" class="error hidden"></div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="hidden">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <h1>üìä LifeQuest Admin Panel</h1>
                <p>Welcome back, <span id="adminName"></span></p>
            </div>

            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Users</h3>
                    <div class="value" id="statTotalUsers">-</div>
                </div>
                <div class="stat-card">
                    <h3>Active Users (7d)</h3>
                    <div class="value" id="statActiveUsers">-</div>
                </div>
                <div class="stat-card">
                    <h3>Total Tasks</h3>
                    <div class="value" id="statTotalTasks">-</div>
                </div>
                <div class="stat-card">
                    <h3>Completion Rate</h3>
                    <div class="value" id="statCompletionRate">-</div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="showTab('users')">üë• Users</button>
                <button class="tab" onclick="showTab('tasks')">‚úÖ Task Templates</button>
                <button class="tab" onclick="showTab('nutrition')">ü•ó Nutrition Database</button>
                <button class="tab" onclick="showTab('content')">üìù Content</button>
                <button class="tab" onclick="showTab('notifications')">üîî Notifications</button>
                <button class="tab" onclick="showTab('logs')">üìú Activity Logs</button>
            </div>

            <!-- Users Section -->
            <div id="usersSection" class="content-section active">
                <h2>User Management</h2>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Email</th>
                            <th>Level</th>
                            <th>XP</th>
                            <th>Streaks</th>
                            <th>Created</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <tr><td colspan="6" style="text-align:center">Loading...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Task Templates Section -->
            <div id="tasksSection" class="content-section">
                <h2>Task Templates</h2>
                <button class="btn" onclick="showCreateTaskModal()">+ Create New Task</button>
                <br><br>
                <table>
                    <thead>
                        <tr>
                            <th>Pillar</th>
                            <th>Title</th>
                            <th>Duration</th>
                            <th>XP</th>
                            <th>Difficulty</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tasksTableBody">
                        <tr><td colspan="6" style="text-align:center">Loading...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Nutrition Database Section -->
            <div id="nutritionSection" class="content-section">
                <h2>Nutrition Database Management</h2>

                <div style="margin-bottom: 24px;">
                    <h3 style="margin-bottom: 12px;">Food Items</h3>
                    <button class="btn" onclick="showCreateFoodModal()">+ Add Food Item</button>
                    <br><br>
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Brand</th>
                                <th>Serving</th>
                                <th>Calories</th>
                                <th>Protein</th>
                                <th>Carbs</th>
                                <th>Fat</th>
                                <th>Category</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="foodItemsTableBody">
                            <tr><td colspan="10" style="text-align:center">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>

                <div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h3 style="margin: 0;">Recipes <span id="recipeCount" style="color: #58CC02; font-weight: 700;">(0)</span></h3>
                        <button class="btn" onclick="showCreateRecipeModal()" style="width: auto; padding: 12px 24px;">+ Add Recipe</button>
                    </div>

                    <!-- Recipe Filters -->
                    <div class="recipe-filters-grid" style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 16px; display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 12px;">
                        <div>
                            <label style="display: block; margin-bottom: 4px; font-size: 13px; font-weight: 600;">Search</label>
                            <input type="text" id="recipeSearchInput" placeholder="Search recipes..." onkeyup="filterRecipes()" style="width: 100%; padding: 10px; border: 2px solid #E5E5E5; border-radius: 6px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 4px; font-size: 13px; font-weight: 600;">Dish Type</label>
                            <select id="recipeDishTypeFilter" onchange="filterRecipes()" style="width: 100%; padding: 10px; border: 2px solid #E5E5E5; border-radius: 6px; font-size: 14px;">
                                <option value="">All Types</option>
                                <option value="pasta">üçù Pasta</option>
                                <option value="rice">üçö Rice</option>
                                <option value="soup">üç≤ Soup</option>
                                <option value="salad">ü•ó Salad</option>
                                <option value="pizza">üçï Pizza</option>
                                <option value="sandwich">ü•™ Sandwich</option>
                                <option value="curry">üçõ Curry</option>
                                <option value="stir-fry">ü•ò Stir Fry</option>
                                <option value="grill">üçó Grilled</option>
                                <option value="baked">ü•ß Baked</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 4px; font-size: 13px; font-weight: 600;">Category</label>
                            <select id="recipeCategoryFilter" onchange="filterRecipes()" style="width: 100%; padding: 10px; border: 2px solid #E5E5E5; border-radius: 6px; font-size: 14px;">
                                <option value="">All Categories</option>
                                <option value="breakfast">Breakfast</option>
                                <option value="lunch">Lunch</option>
                                <option value="dinner">Dinner</option>
                                <option value="snack">Snack</option>
                                <option value="dessert">Dessert</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 4px; font-size: 13px; font-weight: 600;">Cuisine</label>
                            <select id="recipeCuisineFilter" onchange="filterRecipes()" style="width: 100%; padding: 10px; border: 2px solid #E5E5E5; border-radius: 6px; font-size: 14px;">
                                <option value="">All Cuisines</option>
                                <option value="italian">üáÆüáπ Italian</option>
                                <option value="chinese">üá®üá≥ Chinese</option>
                                <option value="mexican">üá≤üáΩ Mexican</option>
                                <option value="indian">üáÆüá≥ Indian</option>
                                <option value="thai">üáπüá≠ Thai</option>
                                <option value="japanese">üáØüáµ Japanese</option>
                                <option value="american">üá∫üá∏ American</option>
                                <option value="french">üá´üá∑ French</option>
                                <option value="greek">üá¨üá∑ Greek</option>
                                <option value="polish">üáµüá± Polish</option>
                            </select>
                        </div>
                    </div>

                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Category</th>
                                <th>Cuisine</th>
                                <th>Dish Type</th>
                                <th>Servings</th>
                                <th>Difficulty</th>
                                <th>Prep Time</th>
                                <th>Calories</th>
                                <th>Visibility</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="recipesTableBody">
                            <tr><td colspan="10" style="text-align:center">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Content Section -->
            <div id="contentSection" class="content-section">
                <h2>Content Management</h2>
                <button class="btn" onclick="showCreateContentModal()">+ Create New Content</button>
                <br><br>
                <table>
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Pillar</th>
                            <th>Title</th>
                            <th>Status</th>
                            <th>Created</th>
                        </tr>
                    </thead>
                    <tbody id="contentTableBody">
                        <tr><td colspan="5" style="text-align:center">Loading...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Notifications Section -->
            <div id="notificationsSection" class="content-section">
                <h2>Push Notifications</h2>
                <button class="btn" onclick="showCreateNotificationModal()">+ Send Notification</button>
                <br><br>
                <table>
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Target</th>
                            <th>Status</th>
                            <th>Scheduled</th>
                            <th>Sent</th>
                        </tr>
                    </thead>
                    <tbody id="notificationsTableBody">
                        <tr><td colspan="5" style="text-align:center">Loading...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Activity Logs Section -->
            <div id="logsSection" class="content-section">
                <h2>Activity Logs</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Admin</th>
                            <th>Action</th>
                            <th>Target</th>
                            <th>Details</th>
                            <th>Time</th>
                        </tr>
                    </thead>
                    <tbody id="logsTableBody">
                        <tr><td colspan="5" style="text-align:center">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Create Task Modal -->
    <div id="createTaskModal" class="modal">
        <div class="modal-content">
            <h2>Create Task Template</h2>
            <div class="form-group">
                <label>Pillar</label>
                <select id="taskPillar" style="width:100%; padding:12px; border:2px solid #E5E5E5; border-radius:8px;">
                    <option value="finance">Finance</option>
                    <option value="mental">Mental</option>
                    <option value="physical">Physical</option>
                    <option value="nutrition">Nutrition</option>
                </select>
            </div>
            <div class="form-group">
                <label>Title</label>
                <input type="text" id="taskTitle" placeholder="Track Your Expenses">
            </div>
            <div class="form-group">
                <label>Description</label>
                <input type="text" id="taskDescription" placeholder="Record 3 expenses from today">
            </div>
            <div class="form-group">
                <label>Duration (minutes)</label>
                <input type="number" id="taskDuration" placeholder="5" value="5">
            </div>
            <div class="form-group">
                <label>XP Reward</label>
                <input type="number" id="taskXP" placeholder="10" value="10">
            </div>
            <div class="form-group">
                <label>Difficulty</label>
                <select id="taskDifficulty" style="width:100%; padding:12px; border:2px solid #E5E5E5; border-radius:8px;">
                    <option value="easy">Easy</option>
                    <option value="medium">Medium</option>
                    <option value="hard">Hard</option>
                </select>
            </div>
            <button class="btn" onclick="createTask()">Create</button>
            <button class="btn btn-secondary" onclick="closeModal('createTaskModal')" style="margin-top:12px;">Cancel</button>
        </div>
    </div>

    <!-- Create Notification Modal -->
    <div id="createNotificationModal" class="modal">
        <div class="modal-content">
            <h2>Send Push Notification</h2>
            <div class="form-group">
                <label>Title</label>
                <input type="text" id="notifTitle" placeholder="New Challenge Available!">
            </div>
            <div class="form-group">
                <label>Body</label>
                <textarea id="notifBody" placeholder="Complete today's tasks to keep your streak alive!" style="width:100%; padding:12px; border:2px solid #E5E5E5; border-radius:8px; min-height:80px;"></textarea>
            </div>
            <div class="form-group">
                <label>Target Segment</label>
                <select id="notifSegment" style="width:100%; padding:12px; border:2px solid #E5E5E5; border-radius:8px;">
                    <option value="all">All Users</option>
                    <option value="active">Active Users</option>
                    <option value="inactive">Inactive Users</option>
                </select>
            </div>
            <button class="btn" onclick="createNotification()">Send Now</button>
            <button class="btn btn-secondary" onclick="closeModal('createNotificationModal')" style="margin-top:12px;">Cancel</button>
        </div>
    </div>

    <!-- Create Food Item Modal -->
    <div id="createFoodModal" class="modal">
        <div class="modal-content">
            <h2>Add Food Item</h2>
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="foodName" placeholder="Chicken Breast">
            </div>
            <div class="form-group">
                <label>Brand (optional)</label>
                <input type="text" id="foodBrand" placeholder="Perdue">
            </div>
            <div class="form-group">
                <label>Serving Size</label>
                <input type="text" id="foodServing" placeholder="100" value="100">
            </div>
            <div class="form-group">
                <label>Serving Unit</label>
                <select id="foodUnit" style="width:100%; padding:12px; border:2px solid #E5E5E5; border-radius:8px;">
                    <option value="g">grams (g)</option>
                    <option value="ml">milliliters (ml)</option>
                    <option value="oz">ounces (oz)</option>
                    <option value="cup">cup</option>
                    <option value="tbsp">tablespoon</option>
                    <option value="tsp">teaspoon</option>
                    <option value="piece">piece</option>
                </select>
            </div>
            <div class="form-group">
                <label>Calories</label>
                <input type="number" id="foodCalories" placeholder="165">
            </div>
            <div class="form-group">
                <label>Protein (g)</label>
                <input type="number" id="foodProtein" placeholder="31" step="0.1">
            </div>
            <div class="form-group">
                <label>Carbs (g)</label>
                <input type="number" id="foodCarbs" placeholder="0" step="0.1">
            </div>
            <div class="form-group">
                <label>Fat (g)</label>
                <input type="number" id="foodFat" placeholder="3.6" step="0.1">
            </div>
            <div class="form-group">
                <label>Category</label>
                <select id="foodCategory" style="width:100%; padding:12px; border:2px solid #E5E5E5; border-radius:8px;">
                    <option value="protein">Protein</option>
                    <option value="carbs">Carbs</option>
                    <option value="vegetables">Vegetables</option>
                    <option value="fruits">Fruits</option>
                    <option value="dairy">Dairy</option>
                    <option value="fats">Fats & Oils</option>
                    <option value="snacks">Snacks</option>
                    <option value="beverages">Beverages</option>
                </select>
            </div>
            <button class="btn" onclick="createFoodItem()">Add Food Item</button>
            <button class="btn btn-secondary" onclick="closeModal('createFoodModal')" style="margin-top:12px;">Cancel</button>
        </div>
    </div>

    <!-- Create Recipe Modal -->
    <div id="createRecipeModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <h2>Add Recipe</h2>
            <div class="form-group">
                <label>Recipe Name</label>
                <input type="text" id="recipeName" placeholder="Grilled Chicken Salad">
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea id="recipeDescription" placeholder="A healthy protein-packed salad..." style="width:100%; padding:12px; border:2px solid #E5E5E5; border-radius:8px; min-height:60px;"></textarea>
            </div>
            <div class="form-group">
                <label>Category</label>
                <select id="recipeCategory" style="width:100%; padding:12px; border:2px solid #E5E5E5; border-radius:8px;">
                    <option value="breakfast">Breakfast</option>
                    <option value="lunch">Lunch</option>
                    <option value="dinner">Dinner</option>
                    <option value="snack">Snack</option>
                    <option value="dessert">Dessert</option>
                </select>
            </div>
            <div class="form-group">
                <label>Dish Type</label>
                <select id="recipeDishType" style="width:100%; padding:12px; border:2px solid #E5E5E5; border-radius:8px;">
                    <option value="">Select type...</option>
                    <option value="pasta">üçù Pasta</option>
                    <option value="rice">üçö Rice</option>
                    <option value="soup">üç≤ Soup</option>
                    <option value="salad">ü•ó Salad</option>
                    <option value="pizza">üçï Pizza</option>
                    <option value="sandwich">ü•™ Sandwich</option>
                    <option value="curry">üçõ Curry</option>
                    <option value="stir-fry">ü•ò Stir Fry</option>
                    <option value="grill">üçó Grilled</option>
                    <option value="baked">ü•ß Baked</option>
                </select>
            </div>
            <div class="form-group">
                <label>Cuisine Type</label>
                <input type="text" id="recipeCuisine" placeholder="American, Italian, Asian...">
            </div>
            <div class="form-group">
                <label>Servings</label>
                <input type="number" id="recipeServings" placeholder="4" value="4">
            </div>
            <div class="form-group">
                <label>Prep Time (minutes)</label>
                <input type="number" id="recipePrepTime" placeholder="15">
            </div>
            <div class="form-group">
                <label>Cook Time (minutes)</label>
                <input type="number" id="recipeCookTime" placeholder="20">
            </div>
            <div class="form-group">
                <label>Difficulty</label>
                <select id="recipeDifficulty" style="width:100%; padding:12px; border:2px solid #E5E5E5; border-radius:8px;">
                    <option value="easy">Easy</option>
                    <option value="medium">Medium</option>
                    <option value="hard">Hard</option>
                </select>
            </div>
            <div class="form-group">
                <label>Instructions</label>
                <textarea id="recipeInstructions" placeholder="1. Step one&#10;2. Step two..." style="width:100%; padding:12px; border:2px solid #E5E5E5; border-radius:8px; min-height:100px;"></textarea>
            </div>
            <div class="form-group">
                <label style="display: flex; align-items: center;">
                    <input type="checkbox" id="recipePublic" style="width: auto; margin-right: 8px;">
                    Make Public (visible to all users)
                </label>
            </div>
            <button class="btn" onclick="createRecipe()">Add Recipe</button>
            <button class="btn btn-secondary" onclick="closeModal('createRecipeModal')" style="margin-top:12px;">Cancel</button>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3001';
        let adminEmail = '';

        // Login
        async function login() {
            const email = document.getElementById('emailInput').value;

            if (email !== 'kamil.rybialek@gmail.com') {
                showError('loginError', 'Unauthorized email');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/api/admin/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });

                const data = await response.json();

                if (response.ok) {
                    adminEmail = email;
                    localStorage.setItem('adminEmail', email);
                    document.getElementById('loginScreen').classList.add('hidden');
                    document.getElementById('adminDashboard').classList.remove('hidden');
                    document.getElementById('adminName').textContent = data.admin.name || email;
                    loadDashboard();
                } else {
                    showError('loginError', data.error);
                }
            } catch (error) {
                showError('loginError', 'Failed to connect to server. Make sure admin API is running.');
            }
        }

        // Load Dashboard
        async function loadDashboard() {
            loadAnalytics();
            loadUsers();
            loadTaskTemplates();
            loadFoodItems();
            loadRecipes();
            loadNotifications();
            loadActivityLogs();
        }

        async function loadAnalytics() {
            const response = await fetch(`${API_URL}/api/admin/analytics`, {
                headers: { 'x-admin-email': adminEmail }
            });
            const data = await response.json();

            document.getElementById('statTotalUsers').textContent = data.totalUsers;
            document.getElementById('statActiveUsers').textContent = data.activeUsers;
            document.getElementById('statTotalTasks').textContent = data.totalTasks;
            document.getElementById('statCompletionRate').textContent = data.completionRate.toFixed(1) + '%';
        }

        async function loadUsers() {
            const response = await fetch(`${API_URL}/api/admin/users`, {
                headers: { 'x-admin-email': adminEmail }
            });
            const data = await response.json();

            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = data.users.map(u => `
                <tr>
                    <td>${u.id}</td>
                    <td>${u.email}</td>
                    <td><span class="badge badge-info">${u.level || 1}</span></td>
                    <td>${u.total_xp || 0} XP</td>
                    <td>üí∞${u.finance_streak || 0} üß†${u.mental_streak || 0} üí™${u.physical_streak || 0} ü•ó${u.nutrition_streak || 0}</td>
                    <td>${new Date(u.created_at).toLocaleDateString()}</td>
                </tr>
            `).join('');
        }

        async function loadTaskTemplates() {
            const response = await fetch(`${API_URL}/api/admin/task-templates`, {
                headers: { 'x-admin-email': adminEmail }
            });
            const data = await response.json();

            const tbody = document.getElementById('tasksTableBody');
            tbody.innerHTML = data.templates.map(t => `
                <tr>
                    <td><span class="badge badge-info">${t.pillar}</span></td>
                    <td>${t.title}</td>
                    <td>${t.duration_minutes} min</td>
                    <td>${t.xp_reward} XP</td>
                    <td><span class="badge badge-warning">${t.difficulty}</span></td>
                    <td><button onclick="deleteTask(${t.id})" style="color:red;border:none;background:none;cursor:pointer;">Delete</button></td>
                </tr>
            `).join('');
        }

        async function loadNotifications() {
            const response = await fetch(`${API_URL}/api/admin/notifications`, {
                headers: { 'x-admin-email': adminEmail }
            });
            const data = await response.json();

            const tbody = document.getElementById('notificationsTableBody');
            tbody.innerHTML = data.notifications.map(n => `
                <tr>
                    <td>${n.title}</td>
                    <td>${n.target_segment || 'User #' + n.target_user_id}</td>
                    <td><span class="badge badge-${n.status === 'sent' ? 'success' : 'warning'}">${n.status}</span></td>
                    <td>${n.scheduled_at || '-'}</td>
                    <td>${n.sent_at || '-'}</td>
                </tr>
            `).join('');
        }

        async function loadActivityLogs() {
            const response = await fetch(`${API_URL}/api/admin/activity-logs`, {
                headers: { 'x-admin-email': adminEmail }
            });
            const data = await response.json();

            const tbody = document.getElementById('logsTableBody');
            tbody.innerHTML = data.logs.map(l => `
                <tr>
                    <td>${l.admin_email}</td>
                    <td><span class="badge badge-info">${l.action}</span></td>
                    <td>${l.target_type || '-'} #${l.target_id || '-'}</td>
                    <td>${l.details || '-'}</td>
                    <td>${new Date(l.created_at).toLocaleString()}</td>
                </tr>
            `).join('');
        }

        // Tab switching
        function showTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tab + 'Section').classList.add('active');
        }

        // Modals
        function showCreateTaskModal() {
            document.getElementById('createTaskModal').classList.add('active');
        }

        function showCreateNotificationModal() {
            document.getElementById('createNotificationModal').classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        async function createTask() {
            const data = {
                pillar: document.getElementById('taskPillar').value,
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                duration: parseInt(document.getElementById('taskDuration').value),
                xp: parseInt(document.getElementById('taskXP').value),
                difficulty: document.getElementById('taskDifficulty').value
            };

            await fetch(`${API_URL}/api/admin/task-templates`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-admin-email': adminEmail
                },
                body: JSON.stringify(data)
            });

            closeModal('createTaskModal');
            loadTaskTemplates();
        }

        async function deleteTask(id) {
            if (!confirm('Delete this task template?')) return;

            await fetch(`${API_URL}/api/admin/task-templates/${id}`, {
                method: 'DELETE',
                headers: { 'x-admin-email': adminEmail }
            });

            loadTaskTemplates();
        }

        async function createNotification() {
            const data = {
                title: document.getElementById('notifTitle').value,
                body: document.getElementById('notifBody').value,
                targetSegment: document.getElementById('notifSegment').value
            };

            await fetch(`${API_URL}/api/admin/notifications`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-admin-email': adminEmail
                },
                body: JSON.stringify(data)
            });

            closeModal('createNotificationModal');
            loadNotifications();
        }

        // Nutrition Functions
        async function loadFoodItems() {
            try {
                const response = await fetch(`${API_URL}/api/admin/food-items`, {
                    headers: { 'x-admin-email': adminEmail }
                });
                const data = await response.json();

                const tbody = document.getElementById('foodItemsTableBody');
                tbody.innerHTML = data.foods.map(f => `
                    <tr>
                        <td><strong>${f.name}</strong></td>
                        <td>${f.brand || '-'}</td>
                        <td>${f.serving_size} ${f.serving_unit}</td>
                        <td>${f.calories}</td>
                        <td>${f.protein}g</td>
                        <td>${f.carbs}g</td>
                        <td>${f.fat}g</td>
                        <td><span class="badge badge-info">${f.category || 'N/A'}</span></td>
                        <td>${f.is_verified ? '<span class="badge badge-success">Verified</span>' : '<span class="badge badge-warning">Unverified</span>'}</td>
                        <td><button onclick="deleteFoodItem(${f.id})" style="color:red;border:none;background:none;cursor:pointer;">Delete</button></td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading food items:', error);
            }
        }

        // Global variable to store all recipes for filtering
        let allRecipes = [];

        async function loadRecipes() {
            try {
                const response = await fetch(`${API_URL}/api/admin/recipes`, {
                    headers: { 'x-admin-email': adminEmail }
                });
                const data = await response.json();

                allRecipes = data.recipes || [];

                // Update recipe count
                document.getElementById('recipeCount').textContent = `(${allRecipes.length})`;

                // Render all recipes initially
                renderRecipes(allRecipes);
            } catch (error) {
                console.error('Error loading recipes:', error);
                document.getElementById('recipesTableBody').innerHTML = '<tr><td colspan="10" style="text-align:center;color:red;">Error loading recipes</td></tr>';
            }
        }

        function renderRecipes(recipes) {
            const tbody = document.getElementById('recipesTableBody');

            if (recipes.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" style="text-align:center;">No recipes found</td></tr>';
                return;
            }

            tbody.innerHTML = recipes.map(r => `
                <tr>
                    <td><strong>${r.title || r.name}</strong></td>
                    <td><span class="badge badge-info">${r.category || 'N/A'}</span></td>
                    <td>${r.cuisine_type || r.cuisines || '-'}</td>
                    <td>${r.dish_type || '-'}</td>
                    <td>${r.servings}</td>
                    <td><span class="badge badge-${r.difficulty === 'easy' ? 'success' : r.difficulty === 'medium' ? 'warning' : 'info'}">${r.difficulty || 'N/A'}</span></td>
                    <td>${r.prep_time_minutes || r.ready_in_minutes || 0}m</td>
                    <td>${r.total_calories || r.calories || 0} cal</td>
                    <td>${r.is_public ? '<span class="badge badge-success">Public</span>' : '<span class="badge badge-warning">Private</span>'}</td>
                    <td><button onclick="deleteRecipe(${r.id})" style="color:red;border:none;background:none;cursor:pointer;font-weight:600;">üóëÔ∏è Delete</button></td>
                </tr>
            `).join('');
        }

        function filterRecipes() {
            const searchTerm = document.getElementById('recipeSearchInput').value.toLowerCase();
            const dishType = document.getElementById('recipeDishTypeFilter').value.toLowerCase();
            const category = document.getElementById('recipeCategoryFilter').value.toLowerCase();
            const cuisine = document.getElementById('recipeCuisineFilter').value.toLowerCase();

            const filtered = allRecipes.filter(recipe => {
                const name = (recipe.title || recipe.name || '').toLowerCase();
                const desc = (recipe.description || recipe.summary || '').toLowerCase();
                const recipeDishType = (recipe.dish_type || '').toLowerCase();
                const recipeCategory = (recipe.category || '').toLowerCase();
                const recipeCuisine = (recipe.cuisine_type || recipe.cuisines || '').toLowerCase();

                // Check search term
                if (searchTerm && !name.includes(searchTerm) && !desc.includes(searchTerm)) {
                    return false;
                }

                // Check dish type
                if (dishType && !recipeDishType.includes(dishType)) {
                    return false;
                }

                // Check category
                if (category && !recipeCategory.includes(category)) {
                    return false;
                }

                // Check cuisine
                if (cuisine && !recipeCuisine.includes(cuisine)) {
                    return false;
                }

                return true;
            });

            renderRecipes(filtered);
        }

        function showCreateFoodModal() {
            document.getElementById('createFoodModal').classList.add('active');
        }

        function showCreateRecipeModal() {
            document.getElementById('createRecipeModal').classList.add('active');
        }

        async function createFoodItem() {
            const data = {
                name: document.getElementById('foodName').value,
                brand: document.getElementById('foodBrand').value || null,
                serving_size: document.getElementById('foodServing').value,
                serving_unit: document.getElementById('foodUnit').value,
                calories: parseFloat(document.getElementById('foodCalories').value),
                protein: parseFloat(document.getElementById('foodProtein').value) || 0,
                carbs: parseFloat(document.getElementById('foodCarbs').value) || 0,
                fat: parseFloat(document.getElementById('foodFat').value) || 0,
                category: document.getElementById('foodCategory').value,
                is_verified: true,
                is_admin_created: true
            };

            try {
                await fetch(`${API_URL}/api/admin/food-items`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-admin-email': adminEmail
                    },
                    body: JSON.stringify(data)
                });

                closeModal('createFoodModal');
                loadFoodItems();

                // Clear form
                document.getElementById('foodName').value = '';
                document.getElementById('foodBrand').value = '';
                document.getElementById('foodCalories').value = '';
                document.getElementById('foodProtein').value = '';
                document.getElementById('foodCarbs').value = '';
                document.getElementById('foodFat').value = '';
            } catch (error) {
                alert('Error creating food item: ' + error.message);
            }
        }

        async function createRecipe() {
            const name = document.getElementById('recipeName').value.trim();
            if (!name) {
                alert('Please enter a recipe name');
                return;
            }

            const data = {
                name: name,
                title: name, // Also send as title for compatibility
                description: document.getElementById('recipeDescription').value || null,
                category: document.getElementById('recipeCategory').value,
                dish_type: document.getElementById('recipeDishType').value || null,
                cuisine_type: document.getElementById('recipeCuisine').value || null,
                cuisines: document.getElementById('recipeCuisine').value || null,
                servings: parseInt(document.getElementById('recipeServings').value),
                prep_time_minutes: parseInt(document.getElementById('recipePrepTime').value) || null,
                ready_in_minutes: parseInt(document.getElementById('recipePrepTime').value) || null,
                cook_time_minutes: parseInt(document.getElementById('recipeCookTime').value) || null,
                difficulty: document.getElementById('recipeDifficulty').value,
                instructions: document.getElementById('recipeInstructions').value || null,
                is_public: document.getElementById('recipePublic').checked,
                is_admin_created: true
            };

            try {
                const response = await fetch(`${API_URL}/api/admin/recipes`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-admin-email': adminEmail
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to create recipe');
                }

                closeModal('createRecipeModal');
                loadRecipes();

                // Clear form
                document.getElementById('recipeName').value = '';
                document.getElementById('recipeDescription').value = '';
                document.getElementById('recipeDishType').value = '';
                document.getElementById('recipeCuisine').value = '';
                document.getElementById('recipeInstructions').value = '';
                document.getElementById('recipePublic').checked = false;

                alert('Recipe created successfully!');
            } catch (error) {
                alert('Error creating recipe: ' + error.message);
            }
        }

        async function deleteFoodItem(id) {
            if (!confirm('Delete this food item?')) return;

            try {
                await fetch(`${API_URL}/api/admin/food-items/${id}`, {
                    method: 'DELETE',
                    headers: { 'x-admin-email': adminEmail }
                });

                loadFoodItems();
            } catch (error) {
                alert('Error deleting food item: ' + error.message);
            }
        }

        async function deleteRecipe(id) {
            if (!confirm('Delete this recipe?')) return;

            try {
                await fetch(`${API_URL}/api/admin/recipes/${id}`, {
                    method: 'DELETE',
                    headers: { 'x-admin-email': adminEmail }
                });

                loadRecipes();
            } catch (error) {
                alert('Error deleting recipe: ' + error.message);
            }
        }

        function showError(elementId, message) {
            const el = document.getElementById(elementId);
            el.textContent = message;
            el.classList.remove('hidden');
        }

        // Check if already logged in
        window.onload = () => {
            const saved = localStorage.getItem('adminEmail');
            if (saved === 'kamil.rybialek@gmail.com') {
                document.getElementById('emailInput').value = saved;
            }
        };

        // PWA Install Logic
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;

            // Show install prompt after user is logged in
            setTimeout(() => {
                if (!localStorage.getItem('pwa-installed')) {
                    const installPrompt = document.getElementById('installPrompt');
                    if (installPrompt) {
                        installPrompt.style.display = 'flex';
                    }
                }
            }, 2000);
        });

        function installPWA() {
            const installPrompt = document.getElementById('installPrompt');
            if (installPrompt) {
                installPrompt.style.display = 'none';
            }

            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('PWA installed');
                        localStorage.setItem('pwa-installed', 'true');
                    }
                    deferredPrompt = null;
                });
            }
        }

        function closeInstallPrompt() {
            const installPrompt = document.getElementById('installPrompt');
            if (installPrompt) {
                installPrompt.style.display = 'none';
            }
            localStorage.setItem('pwa-dismissed', 'true');
        }

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('‚úÖ Service Worker registered', reg))
                    .catch(err => console.log('‚ùå Service Worker registration failed', err));
            });
        }
    </script>

    <!-- PWA Install Prompt -->
    <div id="installPrompt" class="install-prompt">
        <span>üì± Install LifeQuest Admin for quick access</span>
        <button onclick="installPWA()">Install</button>
        <button class="close-install" onclick="closeInstallPrompt()">‚úï</button>
    </div>
</body>
</html>
